import path = require("path")
import { Server } from "@proerd/nextpress/lib/server"
import { ContextFactory, defaultMappers } from "@proerd/nextpress/lib/context"
//
;(async () => {
  const context = ContextFactory({
    projectRoot: path.resolve(__dirname, ".."),
    mappers: defaultMappers('website', 'mailgun', 'knex'),
  })

  await context.database.init({
    currentVersion: 1,
    async migration() {},
  })

  const server = new Server(context)

  server.run()
})()

process.on("unhandledRejection", (...arg: any[]) => {
  console.error("unhandledRejection", ...arg)
  process.exit(1)
})
